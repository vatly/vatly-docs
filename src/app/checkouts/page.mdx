export const metadata = {
  title: 'Checkouts',
  description:
    "On this page, we'll dive into the different checkout endpoints you can use to manage your checkouts programmatically.",
}

# The Checkouts API

The hosted Vatly Checkouts allow your customers to pay for your digital products and services. When the checkout is successfully paid, an Order gets created and any webhooks configured through the dashboard get fired. {{ className: 'lead' }}

## The Checkout API Resource

Below you'll find all properties for the Vatly Checkout API resource.

### Properties

<Properties>
  <Property name="id" type="string">
    Unique identifier for the checkout (starts with `chk_`).
  </Property>
  <Property name="resource" type="string">
    The resource type. Always `checkout`.
  </Property>
  <Property name="merchantId" type="string">
    Unique identifier for the merchant this checkout belongs to.
  </Property>
  <Property name="orderId" type="string | null">
    Unique identifier for the order created from this checkout. Only available when the checkout has been paid successfully.
  </Property>
  <Property name="testmode" type="boolean">
    Whether this checkout is in test mode.
  </Property>
  <Property name="redirectUrlSuccess" type="string">
    The URL to which the checkout should redirect the user after the checkout has been paid successfully.
  </Property>
  <Property name="redirectUrlCanceled" type="string">
    The URL to which the user should get redirected when the user cancels the checkout.
  </Property>
  <Property name="metadata" type="object | null">
    Arbitrary key-value metadata for your application. Up to 50 keys, with key names up to 40 characters and values up to 500 characters.
  </Property>
  <Property name="status" type="string">
    The status of the checkout. Can be `created`, `paid`, `canceled`, `failed`, or `expired`.
  </Property>
  <Property name="expiresAt" type="string | null">
    When this checkout will expire (ISO 8601 format).
  </Property>
  <Property name="createdAt" type="string">
    The moment the checkout was created, in ISO 8601 format.
  </Property>
  <Property name="links" type="object">
    HATEOAS links to related resources. Contains `checkoutUrl` (the hosted checkout page URL), `self`, and optionally `order` (after completion).
  </Property>
</Properties>

---

## List all checkouts {{ tag: 'GET', label: '/v1/checkouts' }}

<Row>
  <Col>

    This endpoint allows you to retrieve a paginated list of all your checkouts. By default, a maximum of ten checkouts are shown per page.

    ### Optional attributes

    <Properties>
      <Property name="limit" type="integer">
        The number of checkouts to return (default: 10, max: 100).
      </Property>
      <Property name="startingAfter" type="string">
        A cursor for use in pagination. Returns results after this checkout ID.
      </Property>
      <Property name="endingBefore" type="string">
        A cursor for use in pagination. Returns results before this checkout ID.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/checkouts">

    ```bash {{ title: 'cURL' }}
    curl -G https://api.vatly.com/v1/checkouts \
      -H "Authorization: Bearer live_your_api_key_here" \
      -d limit=10
    ```

    ```php {{ title: 'PHP' }}
    $vatly = new \Vatly\API\VatlyApiClient();
    $vatly->setApiKey('live_your_api_key_here');

    $checkouts = $vatly->checkouts->page();
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "data": [
        {
          "id": "chk_abc123def456",
          "resource": "checkout",
          "merchantId": "mer_abc123",
          "orderId": "ord_xyz789",
          "testmode": false,
          "redirectUrlSuccess": "https://example.com/success",
          "redirectUrlCanceled": "https://example.com/canceled",
          "metadata": null,
          "status": "paid",
          "expiresAt": "2024-01-15T14:30:00Z",
          "createdAt": "2024-01-15T10:30:00Z",
          "links": {
            "checkoutUrl": {
              "href": "https://pay.vatly.com/chk_abc123def456",
              "type": "text/html"
            },
            "self": {
              "href": "https://api.vatly.com/v1/checkouts/chk_abc123def456",
              "type": "application/json"
            },
            "order": {
              "href": "https://api.vatly.com/v1/orders/ord_xyz789",
              "type": "application/json"
            }
          }
        }
      ],
      "links": {
        "self": {
          "href": "https://api.vatly.com/v1/checkouts?limit=10",
          "type": "application/json"
        },
        "next": {
          "href": "https://api.vatly.com/v1/checkouts?startingAfter=chk_abc123def456&limit=10",
          "type": "application/json"
        },
        "prev": null
      },
      "count": 1
    }
    ```

  </Col>
</Row>

---

## Create a checkout {{ tag: 'POST', label: '/v1/checkouts' }}

<Row>
  <Col>

    This endpoint allows you to start a new hosted Vatly Checkout. Make sure you have at least one subscription plan or one-off product configured in your Vatly account.

    Once paid, any subscription plan product assigned to the checkout will kick off a new subscription for that plan.

    ### Required attributes

    <Properties>
      <Property name="products" type="array">
        An array of product objects to include in this checkout. Each product can have:
        - `id` (required): Product ID (starts with `prod_` for one-off products or `plan_` for subscription plans)
        - `quantity` (optional): Number of units to purchase (default: 1)
        - `price` (optional): Custom price override as a Money object `{value: "X.XX", currency: "EUR"}`
        - `trialDays` (optional): Trial period in days (only for subscription plans)
        - `metadata` (optional): Additional metadata for this product
      </Property>
      <Property name="redirectUrlSuccess" type="string">
        The URL to which the checkout should redirect the user after the checkout has been paid successfully.
      </Property>
      <Property name="redirectUrlCanceled" type="string">
        The URL to which the user should get redirected when the user cancels the checkout.
      </Property>
    </Properties>

    ### Optional attributes

    <Properties>
      <Property name="metadata" type="object">
        Arbitrary key-value metadata for your application.
      </Property>
      <Property name="customerId" type="string">
        The ID for an existing customer to associate with this checkout. If provided, the customer's email will be pre-filled. Must match the testmode of the API token.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="POST" label="/v1/checkouts">

    ```bash {{ title: 'cURL' }}
    curl https://api.vatly.com/v1/checkouts \
      -H "Authorization: Bearer live_your_api_key_here" \
      -H "Content-Type: application/json" \
      -d '{
        "products": [
          {"id": "prod_abc123", "quantity": 1},
          {"id": "plan_xyz789", "trialDays": 14}
        ],
        "redirectUrlSuccess": "https://example.com/success",
        "redirectUrlCanceled": "https://example.com/canceled"
      }'
    ```

    ```php {{ title: 'PHP' }}
    $vatly = new \Vatly\API\VatlyApiClient();
    $vatly->setApiKey('live_your_api_key_here');

    $checkout = $vatly->checkouts->create([
      'products' => [
        ['id' => 'prod_abc123', 'quantity' => 1],
        ['id' => 'plan_xyz789', 'trialDays' => 14],
      ],
      'redirectUrlSuccess' => 'https://example.com/success',
      'redirectUrlCanceled' => 'https://example.com/canceled',
    ]);

    // Redirect the user to the checkout URL
    header('Location: ' . $checkout->links->checkoutUrl->href, true, 303);
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "id": "chk_abc123def456",
      "resource": "checkout",
      "merchantId": "mer_abc123",
      "orderId": null,
      "testmode": false,
      "redirectUrlSuccess": "https://example.com/success",
      "redirectUrlCanceled": "https://example.com/canceled",
      "metadata": null,
      "status": "created",
      "expiresAt": "2024-01-15T14:30:00Z",
      "createdAt": "2024-01-15T10:30:00Z",
      "links": {
        "checkoutUrl": {
          "href": "https://pay.vatly.com/chk_abc123def456",
          "type": "text/html"
        },
        "self": {
          "href": "https://api.vatly.com/v1/checkouts/chk_abc123def456",
          "type": "application/json"
        },
        "order": null
      }
    }
    ```

  </Col>
</Row>

---

## Retrieve a checkout {{ tag: 'GET', label: '/v1/checkouts/:id' }}

<Row>
  <Col>

    This endpoint allows you to retrieve a checkout by providing the checkout id. Refer to [the list](#the-checkout-api-resource) at the top of this page to see which properties are included with checkout objects.

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/checkouts/chk_abc123def456">

    ```bash {{ title: 'cURL' }}
    curl https://api.vatly.com/v1/checkouts/chk_abc123def456 \
      -H "Authorization: Bearer live_your_api_key_here"
    ```

    ```php {{ title: 'PHP' }}
    $vatly = new \Vatly\API\VatlyApiClient();
    $vatly->setApiKey('live_your_api_key_here');

    $checkout = $vatly->checkouts->get('chk_abc123def456');
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "id": "chk_abc123def456",
      "resource": "checkout",
      "merchantId": "mer_abc123",
      "orderId": "ord_xyz789",
      "testmode": false,
      "redirectUrlSuccess": "https://example.com/success",
      "redirectUrlCanceled": "https://example.com/canceled",
      "metadata": null,
      "status": "paid",
      "expiresAt": "2024-01-15T14:30:00Z",
      "createdAt": "2024-01-15T10:30:00Z",
      "links": {
        "checkoutUrl": {
          "href": "https://pay.vatly.com/chk_abc123def456",
          "type": "text/html"
        },
        "self": {
          "href": "https://api.vatly.com/v1/checkouts/chk_abc123def456",
          "type": "application/json"
        },
        "order": {
          "href": "https://api.vatly.com/v1/orders/ord_xyz789",
          "type": "application/json"
        }
      }
    }
    ```

  </Col>
</Row>
