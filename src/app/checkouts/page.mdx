export const metadata = {
  title: 'Checkouts',
  description:
    'On this page, we’ll dive into the different checkout endpoints you can use to manage your checkouts programmatically.',
}

# The Checkouts API

The hosted Vatly Checkouts allow your customers to pay for your digital products and services. When the checkout is succesfully completed, an Order gets created and any webhooks configured through the dashboard get fired. {{ className: 'lead' }}

## The Checkout API Resource

Below you'll find all properties for the Vatly Checkout API resource.

### Properties

<Properties>
  <Property name="id" type="string">
    Unique identifier for the checkout.
  </Property>
  <Property name="merchantId" type="string">
    Unique identifier for the merchant this checkout belongs to.
  </Property>
  <Property name="orderId" type="string">
    Unique identifier for the order this checkout belongs to. Only available when the checkout has been completed succesfully.
  </Property>
  <Property name="testmode" type="boolean">
    Whether this checkout is in test mode.
  </Property>
  <Property name="redirectUrlSuccess" type="string">
    The URL to which the checkout should redirect the user after the checkout has been completed succesfully.
  </Property>
  <Property name="redirectUrlCanceled" type="string">
    The URL to which the user should get redirected when the user cancels the checkout.
  </Property>
  <Property name="metadata" type="string">
    Any metadata associated with the checkout. Provide any data you like to be stored with the checkout.
  </Property>
  <Property name="status" type="string">
    The status of the checkout. Can be `created`, `pending`, `paid`, `failed`, `expired`, or `canceled`.
  </Property>
  <Property name="createdAt" type="string">
    The moment the checkout was created, in ISO 8601 format.
  </Property>
  <Property name="_links_" type="string">
    An object with API urls and other hyperlinks relevant to the checkout. Specifically, the `checkoutUrl` property contains the URL to which the user should be redirected to complete the checkout.
  </Property>
</Properties>

---

{/* ## List all checkouts {{ tag: 'GET', label: '/v1/checkouts' }}

<Row>
  <Col>

    This endpoint allows you to retrieve a paginated list of all your checkouts. By default, a maximum of ten checkouts are shown per page.

    ### Optional attributes

    <Properties>
      <Property name="limit" type="integer">
        Limit the number of checkouts returned.
      </Property>
      <Property name="muted" type="boolean">
        Only show checkouts that are muted when set to `true`.
      </Property>
      <Property name="archived" type="boolean">
        Only show checkouts that are archived when set to `true`.
      </Property>
      <Property name="pinned" type="boolean">
        Only show checkouts that are pinned when set to `true`.
      </Property>
      <Property name="group_id" type="string">
        Only show checkouts for the specified group.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/checkouts">

    ```bash {{ title: 'cURL' }}
    curl -G https://api.vatly.com/v1/checkouts \
      -H "Authorization: Bearer {token}" \
      -d limit=10
    ```

    ```js
    import ApiClient from '@example/protocol-api'

    const client = new ApiClient(token)

    await client.checkouts.list()
    ```

    ```python
    from protocol_api import ApiClient

    client = ApiClient(token)

    client.checkouts.list()
    ```

    ```php
    $client = new \Vatly\ApiClient($token);

    $client->checkouts->list();
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "has_more": false,
      "data": [
        {
          "id": "xgQQXg3hrtjh7AvZ",
          "contact_id": "WAz8eIbvDR60rouK",
          "group_id": null,
          "pinned_subscription_plan_id": null,
          "is_pinned": false,
          "is_muted": false,
          "last_active_at": 705103200,
          "last_opened_at": 705103200,
          "created_at": 692233200,
          "archived_at": null
        },
        {
          "id": "hSIhXBhNe8X1d8Et"
          // ...
        }
      ]
    }
    ```

  </Col>
</Row>

--- */}

## Create a checkout {{ tag: 'POST', label: '/v1/checkouts' }}

<Row>
  <Col>

    This endpoint allows you to start a new hosted Vatly Checkout. Make sure you have at least one subscription plan or one-off product configured in your Vatly account.

    Once paid, any subscription plan product assigned to the checkout will kick off a new subscription for that plan.

    ### Required attributes

    <Properties>
      <Property name="products" type="array">
        An array of IDs for the products you want to checkout. Both subscription plan IDs and one-off product IDs can be used in this array.
      </Property>
      <Property name="redirectUrlSuccess" type="string">
        The URL to which the checkout should redirect the user after the checkout has been completed succesfully.
      </Property>
      <Property name="redirectUrlCanceled" type="string">
        The URL to which the user should get redirected when the user cancels the checkout.
      </Property>
    </Properties>

    ### Optional attributes

    <Properties>
      <Property name="metadata" type="string">
        Any metadata associated with the checkout. Provide any data you like to be stored with the checkout.
      </Property>
      <Property name="customerId" type="string">
        The ID for the customer this checkout belongs to. If no customer ID is provided, a new customer will be created once the checkout is completed succesfully.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="POST" label="/v1/checkouts">

    ```bash {{ title: 'cURL' }}
    curl https://api.vatly.com/v1/checkouts \
      -H "Authorization: Bearer {token}" \
      -d 'products[]'="subscription_plan_d6ZPGVg4PEewUukwYd5zH"
      -d 'products[]'="one_off_Hd5zYukwUEPegV6ZPGd"
    ```

    {/* ```js
    import ApiClient from '@example/protocol-api'

    const client = new ApiClient(token)

    await client.checkouts.create({
      contact_id: 'WAz8eIbvDR60rouK',
    })
    ```

    ```python
    from protocol_api import ApiClient

    client = ApiClient(token)

    client.checkouts.create(contact_id="WAz8eIbvDR60rouK")
    ``` */}

    ```php
    $client = new \Vatly\ApiClient($token);

    $checkout = $client->checkouts->create([
      'products' => [],
      'redirectUrlSuccess' => 'https://example.com/success',
      'redirectUrlCanceled' => 'https://example.com/canceled',
    ]);

    // Redirect the user to the checkout URL
    header('Location: ' . $checkout->getCheckoutUrl(), true, 303);
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "id": "checkout_xgQQXg3hrtjh7AvZ",
      "merchantId": "merchant_WAz8eIbvDR60rouK",
      "orderId": null,
      "testmode": false,
      "redirectUrlSuccess": "https://example.com/success",
      "redirectUrlCanceled": "https://example.com/canceled",
      "metadata": null,
      "status": "created",
      "createdAt": "2024-12-14T13:32:24.000Z",
      "_links": {
        "checkoutUrl": "https://pay.vatly.com/checkout_xgQQXg3hrtjh7AvZ"
    }
    ```

  </Col>
</Row>

---

{/* ## Retrieve a checkout {{ tag: 'GET', label: '/v1/checkouts/:id' }}

<Row>
  <Col>

    This endpoint allows you to retrieve a checkout by providing the checkout id. Refer to [the list](#the-checkout-model) at the top of this page to see which properties are included with checkout objects.

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/checkouts/xgQQXg3hrtjh7AvZ">

    ```bash {{ title: 'cURL' }}
    curl https://api.vatly.com/v1/checkouts/xgQQXg3hrtjh7AvZ \
      -H "Authorization: Bearer {token}"
    ```

    ```js
    import ApiClient from '@example/protocol-api'

    const client = new ApiClient(token)

    await client.checkouts.get('xgQQXg3hrtjh7AvZ')
    ```

    ```python
    from protocol_api import ApiClient

    client = ApiClient(token)

    client.checkouts.get("xgQQXg3hrtjh7AvZ")
    ```

    ```php
    $client = new \Vatly\ApiClient($token);

    $client->checkouts->get('xgQQXg3hrtjh7AvZ');
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "id": "xgQQXg3hrtjh7AvZ",
      "contact_id": "WAz8eIbvDR60rouK",
      "group_id": null,
      "pinned_subscription_plan_id": null,
      "is_pinned": false,
      "is_muted": false,
      "last_active_at": 705103200,
      "last_opened_at": 705103200,
      "created_at": 692233200,
      "archived_at": null
    }
    ```

  </Col>
</Row>

---

## Update a checkout {{ tag: 'PUT', label: '/v1/checkouts/:id' }}

<Row>
  <Col>

    This endpoint allows you to perform an update on a checkout. Examples of updates are pinning a subscription, muting or archiving the checkout, or pinning the checkout itself.

    ### Optional attributes

    <Properties>
      <Property name="pinned" type="boolean">
        Whether or not the checkout has been pinned.
      </Property>
      <Property name="muted" type="boolean">
        Whether or not the checkout has been muted.
      </Property>
      <Property name="archived_at" type="timestamp">
        Timestamp of when the checkout was archived.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="PUT" label="/v1/checkouts/xgQQXg3hrtjh7AvZ">

    ```bash {{ title: 'cURL' }}
    curl -X PUT https://api.vatly.com/v1/checkouts/xgQQXg3hrtjh7AvZ \
      -H "Authorization: Bearer {token}" \
      -d 'muted'=true
    ```

    ```js
    import ApiClient from '@example/protocol-api'

    const client = new ApiClient(token)

    await client.checkouts.update('xgQQXg3hrtjh7AvZ', {
        muted: true,
    })
    ```

    ```python
    from protocol_api import ApiClient

    client = ApiClient(token)

    client.checkouts.update("xgQQXg3hrtjh7AvZ", muted=True)
    ```

    ```php
    $client = new \Vatly\ApiClient($token);

    $client->checkouts->update('xgQQXg3hrtjh7AvZ', [
      'muted' => true,
    ]);
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "id": "xgQQXg3hrtjh7AvZ",
      "contact_id": "WAz8eIbvDR60rouK",
      "group_id": null,
      "pinned_subscription_plan_id": null,
      "is_pinned": false,
      "is_muted": true,
      "last_active_at": 705103200,
      "last_opened_at": 705103200,
      "created_at": 692233200,
      "archived_at": null
    }
    ```

  </Col>
</Row>

---

## Delete a checkout {{ tag: 'DELETE', label: '/v1/checkouts/:id' }}

<Row>
  <Col>

    This endpoint allows you to delete your checkouts in Vatly. Note: This will permanently delete the checkout and all its subscriptions — archive it instead if you want to be able to restore it later.

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="DELETE" label="/v1/checkouts/xgQQXg3hrtjh7AvZ">

    ```bash {{ title: 'cURL' }}
    curl -X DELETE https://api.vatly.com/v1/checkouts/xgQQXg3hrtjh7AvZ \
      -H "Authorization: Bearer {token}"
    ```

    ```js
    import ApiClient from '@example/protocol-api'

    const client = new ApiClient(token)

    await client.checkouts.delete('xgQQXg3hrtjh7AvZ')
    ```

    ```python
    from protocol_api import ApiClient

    client = ApiClient(token)

    client.checkouts.delete("xgQQXg3hrtjh7AvZ")
    ```

    ```php
    $client = new \Vatly\ApiClient($token);

    $client->checkouts->delete('xgQQXg3hrtjh7AvZ');
    ```

    </CodeGroup>

  </Col>
</Row> */}
