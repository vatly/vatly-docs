export const metadata = {
  title: 'Subscriptions',
  description:
    'On this page, we\'ll dive into the different subscription endpoints you can use to manage subscriptions programmatically.',
}

# The Subscriptions API

Subscriptions enable you to charge your customers periodically for your digital products and services. You can start a new subscription by creating a checkout through the [Checkouts API](/checkouts). {{ className: 'lead' }}

## The Subscription API Resource

The subscription model contains all the information about recurring billing relationships with customers.

### Properties

<Properties>
  <Property name="id" type="string">
    Unique identifier for the subscription (starts with `sub_`).
  </Property>
  <Property name="resource" type="string">
    The resource type. Always `subscription`.
  </Property>
  <Property name="customerId" type="string">
    ID of the customer who owns this subscription.
  </Property>
  <Property name="testmode" type="boolean">
    Whether this resource is in test mode.
  </Property>
  <Property name="name" type="string">
    The name for the subscription (from the plan).
  </Property>
  <Property name="description" type="string">
    The description for the subscription.
  </Property>
  <Property name="billingAddress" type="object">
    The customer billing address for the subscription. Includes `fullName`, `companyName`, `vatNumber`, `streetAndNumber`, `streetAdditional`, `city`, `region`, `postalCode`, and `country`.
  </Property>
  <Property name="basePrice" type="Money">
    The base price per billing cycle before taxes. A Money object with `value` (decimal string) and `currency` (ISO 4217 code).
  </Property>
  <Property name="quantity" type="integer">
    The quantity for the subscription (e.g., number of seats).
  </Property>
  <Property name="interval" type="string">
    The billing interval. Can be `day`, `week`, `month`, or `year`.
  </Property>
  <Property name="intervalCount" type="integer">
    The interval count, e.g., "3" for charging every 3 months.
  </Property>
  <Property name="status" type="string">
    The status for the subscription. Can be `created`, `trial`, `active`, `canceled`, `on_grace_period`, or `paused`.
  </Property>
  <Property name="startedAt" type="string | null">
    When the subscription started (ISO 8601 format).
  </Property>
  <Property name="endedAt" type="string | null">
    When the subscription ended (ISO 8601 format). Null if the subscription is still active.
  </Property>
  <Property name="cancelledAt" type="string | null">
    When the subscription was cancelled (ISO 8601 format). Null if not cancelled.
  </Property>
  <Property name="renewedAt" type="string | null">
    When the subscription was last renewed (ISO 8601 format).
  </Property>
  <Property name="renewedUntil" type="string | null">
    Current billing period end date (ISO 8601 format).
  </Property>
  <Property name="nextRenewalAt" type="string | null">
    When the next renewal will be attempted (ISO 8601 format). Null if subscription is canceled or ended.
  </Property>
  <Property name="trialUntil" type="string | null">
    When the trial period ends (ISO 8601 format). Null if not in trial or trial has ended.
  </Property>
  <Property name="links" type="object">
    HATEOAS links to related resources. Contains `self` and `customer` links.
  </Property>
</Properties>

---

## List all subscriptions {{ tag: 'GET', label: '/v1/subscriptions' }}

<Row>
  <Col>

    This endpoint allows you to retrieve a paginated list of all subscriptions across your account.

    ### Optional attributes

    <Properties>
      <Property name="limit" type="integer">
        The number of subscriptions to return (default: 10, max: 100).
      </Property>
      <Property name="startingAfter" type="string">
        A cursor for use in pagination. Returns results after this subscription ID.
      </Property>
      <Property name="endingBefore" type="string">
        A cursor for use in pagination. Returns results before this subscription ID.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/subscriptions">

    ```bash {{ title: 'cURL' }}
    curl -G https://api.vatly.com/v1/subscriptions \
      -H "Authorization: Bearer live_your_api_key_here" \
      -d limit=10
    ```

    ```php {{ title: 'PHP' }}
    $vatly = new \Vatly\API\VatlyApiClient();
    $vatly->setApiKey('live_your_api_key_here');

    $subscriptions = $vatly->subscriptions->page();
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "data": [
        {
          "id": "sub_abc123def456",
          "resource": "subscription",
          "customerId": "cus_xyz789",
          "testmode": false,
          "name": "Premium Plan",
          "description": "Access to all premium features",
          "billingAddress": {
            "fullName": "John Doe",
            "companyName": null,
            "vatNumber": null,
            "streetAndNumber": "123 Main St",
            "streetAdditional": "Suite 123",
            "city": "Anytown",
            "region": "CA",
            "postalCode": "12345",
            "country": "US"
          },
          "basePrice": {
            "value": "99.99",
            "currency": "EUR"
          },
          "quantity": 1,
          "interval": "month",
          "intervalCount": 1,
          "status": "active",
          "startedAt": "2023-01-01T00:00:00Z",
          "endedAt": null,
          "cancelledAt": null,
          "renewedAt": "2023-06-01T00:00:00Z",
          "renewedUntil": "2023-07-01T00:00:00Z",
          "nextRenewalAt": "2023-07-01T00:00:00Z",
          "trialUntil": null,
          "links": {
            "self": {
              "href": "https://api.vatly.com/v1/subscriptions/sub_abc123def456",
              "type": "application/json"
            },
            "customer": {
              "href": "https://api.vatly.com/v1/customers/cus_xyz789",
              "type": "application/json"
            }
          }
        }
      ],
      "links": {
        "self": {
          "href": "https://api.vatly.com/v1/subscriptions?limit=10",
          "type": "application/json"
        },
        "next": {
          "href": "https://api.vatly.com/v1/subscriptions?startingAfter=sub_abc123def456&limit=10",
          "type": "application/json"
        },
        "prev": null
      },
      "count": 1
    }
    ```

  </Col>
</Row>

---

## Get a subscription {{ tag: 'GET', label: '/v1/subscriptions/:id' }}

<Row>
  <Col>

    This endpoint allows you to retrieve a specific subscription by its ID.

    ### Parameters

    <Properties>
      <Property name="subscriptionId" type="string">
        The unique identifier of the subscription.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/subscriptions/sub_abc123def456">

    ```bash {{ title: 'cURL' }}
    curl https://api.vatly.com/v1/subscriptions/sub_abc123def456 \
      -H "Authorization: Bearer live_your_api_key_here"
    ```

    ```php {{ title: 'PHP' }}
    $vatly = new \Vatly\API\VatlyApiClient();
    $vatly->setApiKey('live_your_api_key_here');

    $subscription = $vatly->subscriptions->get('sub_abc123def456');
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "id": "sub_abc123def456",
      "resource": "subscription",
      "customerId": "cus_xyz789",
      "testmode": false,
      "name": "Premium Plan",
      "description": "Access to all premium features",
      "billingAddress": {
        "fullName": "John Doe",
        "companyName": null,
        "vatNumber": null,
        "streetAndNumber": "123 Main St",
        "streetAdditional": "Suite 123",
        "city": "Anytown",
        "region": "CA",
        "postalCode": "12345",
        "country": "US"
      },
      "basePrice": {
        "value": "99.99",
        "currency": "EUR"
      },
      "quantity": 1,
      "interval": "month",
      "intervalCount": 1,
      "status": "active",
      "startedAt": "2023-01-01T00:00:00Z",
      "endedAt": null,
      "cancelledAt": null,
      "renewedAt": "2023-06-01T00:00:00Z",
      "renewedUntil": "2023-07-01T00:00:00Z",
      "nextRenewalAt": "2023-07-01T00:00:00Z",
      "trialUntil": null,
      "links": {
        "self": {
          "href": "https://api.vatly.com/v1/subscriptions/sub_abc123def456",
          "type": "application/json"
        },
        "customer": {
          "href": "https://api.vatly.com/v1/customers/cus_xyz789",
          "type": "application/json"
        }
      }
    }
    ```

  </Col>
</Row>

---

## List customer subscriptions {{ tag: 'GET', label: '/v1/customers/:customerId/subscriptions' }}

<Row>
  <Col>

    This endpoint allows you to retrieve a paginated list of all subscriptions for a specific customer.

    ### Parameters

    <Properties>
      <Property name="customerId" type="string">
        The unique identifier of the customer.
      </Property>
      <Property name="limit" type="integer">
        The number of subscriptions to return (default: 10, max: 100).
      </Property>
      <Property name="startingAfter" type="string">
        A cursor for use in pagination. Returns results after this subscription ID.
      </Property>
      <Property name="endingBefore" type="string">
        A cursor for use in pagination. Returns results before this subscription ID.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/customers/cus_xyz789/subscriptions">

    ```bash {{ title: 'cURL' }}
    curl -G https://api.vatly.com/v1/customers/cus_xyz789/subscriptions \
      -H "Authorization: Bearer live_your_api_key_here" \
      -d limit=10
    ```

    ```php {{ title: 'PHP' }}
    $vatly = new \Vatly\API\VatlyApiClient();
    $vatly->setApiKey('live_your_api_key_here');

    $subscriptions = $vatly->customers->subscriptions('cus_xyz789')->page();
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "data": [
        {
          "id": "sub_abc123def456",
          "resource": "subscription",
          "customerId": "cus_xyz789",
          "testmode": false,
          "name": "Premium Plan",
          "description": "Access to all premium features",
          "status": "active",
          "startedAt": "2023-01-01T00:00:00Z",
          "nextRenewalAt": "2023-07-01T00:00:00Z"
        }
      ],
      "links": {
        "self": {
          "href": "https://api.vatly.com/v1/customers/cus_xyz789/subscriptions?limit=10",
          "type": "application/json"
        },
        "next": {
          "href": "https://api.vatly.com/v1/customers/cus_xyz789/subscriptions?startingAfter=sub_abc123def456&limit=10",
          "type": "application/json"
        },
        "prev": null
      },
      "count": 1
    }
    ```

  </Col>
</Row>

---

## Get a customer subscription {{ tag: 'GET', label: '/v1/customers/:customerId/subscriptions/:subscriptionId' }}

<Row>
  <Col>

    This endpoint allows you to retrieve a specific subscription for a specific customer.

    ### Parameters

    <Properties>
      <Property name="customerId" type="string">
        The unique identifier of the customer.
      </Property>
      <Property name="subscriptionId" type="string">
        The unique identifier of the subscription.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="GET" label="/v1/customers/cus_xyz789/subscriptions/sub_abc123def456">

    ```bash {{ title: 'cURL' }}
    curl https://api.vatly.com/v1/customers/cus_xyz789/subscriptions/sub_abc123def456 \
      -H "Authorization: Bearer live_your_api_key_here"
    ```

    ```php {{ title: 'PHP' }}
    $vatly = new \Vatly\API\VatlyApiClient();
    $vatly->setApiKey('live_your_api_key_here');

    $subscription = $vatly->customers->subscriptions('cus_xyz789')->get('sub_abc123def456');
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "id": "sub_abc123def456",
      "resource": "subscription",
      "customerId": "cus_xyz789",
      "testmode": false,
      "name": "Premium Plan",
      "description": "Access to all premium features",
      "billingAddress": {
        "fullName": "John Doe",
        "companyName": null,
        "vatNumber": null,
        "streetAndNumber": "123 Main St",
        "streetAdditional": "Suite 123",
        "city": "Anytown",
        "region": "CA",
        "postalCode": "12345",
        "country": "US"
      },
      "basePrice": {
        "value": "99.99",
        "currency": "EUR"
      },
      "quantity": 1,
      "interval": "month",
      "intervalCount": 1,
      "status": "active",
      "startedAt": "2023-01-01T00:00:00Z",
      "endedAt": null,
      "cancelledAt": null,
      "renewedAt": "2023-06-01T00:00:00Z",
      "renewedUntil": "2023-07-01T00:00:00Z",
      "nextRenewalAt": "2023-07-01T00:00:00Z",
      "trialUntil": null,
      "links": {
        "self": {
          "href": "https://api.vatly.com/v1/subscriptions/sub_abc123def456",
          "type": "application/json"
        },
        "customer": {
          "href": "https://api.vatly.com/v1/customers/cus_xyz789",
          "type": "application/json"
        }
      }
    }
    ```

  </Col>
</Row>

---

## Update a subscription {{ tag: 'PATCH', label: '/v1/subscriptions/:id' }}

<Row>
  <Col>

    This endpoint allows you to update a subscription. You can change the plan, quantity, or apply proration settings.

    ### Optional attributes

    At least one of `subscriptionPlanId` or `quantity` must be provided.

    <Properties>
      <Property name="subscriptionPlanId" type="string">
        The ID of the subscription plan to update to (starts with `plan_`). Must match the testmode of the current subscription.
      </Property>
      <Property name="quantity" type="integer">
        The new quantity for the subscription. Must be at least 1.
      </Property>
      <Property name="prorate" type="boolean">
        Whether to prorate charges for the partial billing period. If true, the customer is credited for unused time on the old plan and charged for remaining time on the new plan. Default: `true`.
      </Property>
      <Property name="applyImmediately" type="boolean">
        Whether to apply changes immediately or at the end of the current billing period. Default: `false`.
      </Property>
      <Property name="invoiceImmediately" type="boolean">
        Whether to generate an invoice immediately for proration. Only applies when `applyImmediately` and `prorate` are both true. Default: `false`.
      </Property>
      <Property name="anchor" type="date">
        Reset the billing anchor to this date. Cannot be combined with `trialUntil`.
      </Property>
      <Property name="trialUntil" type="string">
        Extend or set a trial period until this date (ISO 8601 format). Cannot be combined with `anchor`.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="PATCH" label="/v1/subscriptions/sub_abc123def456">

    ```bash {{ title: 'cURL' }}
    curl -X PATCH https://api.vatly.com/v1/subscriptions/sub_abc123def456 \
      -H "Authorization: Bearer live_your_api_key_here" \
      -H "Content-Type: application/json" \
      -d '{
        "subscriptionPlanId": "plan_yearly123",
        "quantity": 3,
        "prorate": true,
        "applyImmediately": true
      }'
    ```

    ```php {{ title: 'PHP' }}
    $vatly = new \Vatly\API\VatlyApiClient();
    $vatly->setApiKey('live_your_api_key_here');

    $subscription = $vatly->subscriptions->update('sub_abc123def456', [
        'subscriptionPlanId' => 'plan_yearly123',
        'quantity' => 3,
        'prorate' => true,
        'applyImmediately' => true,
    ]);
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "id": "sub_abc123def456",
      "resource": "subscription",
      "customerId": "cus_xyz789",
      "testmode": false,
      "name": "Premium Yearly",
      "description": "Access to all premium features, billed annually",
      "billingAddress": {
        "fullName": "John Doe",
        "companyName": null,
        "vatNumber": null,
        "streetAndNumber": "123 Main St",
        "streetAdditional": "Suite 123",
        "city": "Anytown",
        "region": "CA",
        "postalCode": "12345",
        "country": "US"
      },
      "basePrice": {
        "value": "999.00",
        "currency": "EUR"
      },
      "quantity": 3,
      "interval": "year",
      "intervalCount": 1,
      "status": "active",
      "startedAt": "2023-01-01T00:00:00Z",
      "endedAt": null,
      "cancelledAt": null,
      "renewedAt": "2023-06-01T00:00:00Z",
      "renewedUntil": "2024-06-01T00:00:00Z",
      "nextRenewalAt": "2024-06-01T00:00:00Z",
      "trialUntil": null,
      "links": {
        "self": {
          "href": "https://api.vatly.com/v1/subscriptions/sub_abc123def456",
          "type": "application/json"
        },
        "customer": {
          "href": "https://api.vatly.com/v1/customers/cus_xyz789",
          "type": "application/json"
        }
      }
    }
    ```

  </Col>
</Row>

---

## Update subscription billing details {{ tag: 'POST', label: '/v1/subscriptions/:id/update-billing' }}

<Row>
  <Col>

    This endpoint initiates a hosted flow for updating subscription billing details. It returns a URL where the customer can update their billing information and payment method.

    ### Required attributes

    <Properties>
      <Property name="redirectUrlSuccess" type="string">
        URL to redirect after successful billing update.
      </Property>
      <Property name="redirectUrlCanceled" type="string">
        URL to redirect if customer cancels the update.
      </Property>
    </Properties>

    ### Optional attributes

    <Properties>
      <Property name="billingAddress" type="object">
        Pre-fill billing address fields. Customer can modify these values in the hosted form.
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="POST" label="/v1/subscriptions/sub_abc123def456/update-billing">

    ```bash {{ title: 'cURL' }}
    curl -X POST https://api.vatly.com/v1/subscriptions/sub_abc123def456/update-billing \
      -H "Authorization: Bearer live_your_api_key_here" \
      -H "Content-Type: application/json" \
      -d '{
        "redirectUrlSuccess": "https://example.com/billing-updated",
        "redirectUrlCanceled": "https://example.com/billing-canceled",
        "billingAddress": {
          "country": "NL",
          "streetAndNumber": "456 New St",
          "city": "Amsterdam",
          "postalCode": "1012AB"
        }
      }'
    ```

    ```php {{ title: 'PHP' }}
    $vatly = new \Vatly\API\VatlyApiClient();
    $vatly->setApiKey('live_your_api_key_here');

    $response = $vatly->subscriptions->updateBilling('sub_abc123def456', [
        'redirectUrlSuccess' => 'https://example.com/billing-updated',
        'redirectUrlCanceled' => 'https://example.com/billing-canceled',
        'billingAddress' => [
            'country' => 'NL',
            'streetAndNumber' => '456 New St',
            'city' => 'Amsterdam',
            'postalCode' => '1012AB',
        ],
    ]);

    // Redirect the customer to the hosted billing update page
    header('Location: ' . $response->links->billingUpdateUrl->href, true, 303);
    ```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "links": {
        "billingUpdateUrl": {
          "href": "https://pay.vatly.com/billing/sub_abc123def456?token=xyz...",
          "type": "text/html"
        }
      }
    }
    ```

  </Col>
</Row>

---

## Cancel a subscription {{ tag: 'DELETE', label: '/v1/subscriptions/:id' }}

<Row>
  <Col>

    This endpoint allows you to cancel a subscription. The subscription will remain active until the end of the current billing period (grace period), after which it will be fully canceled.

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="DELETE" label="/v1/subscriptions/sub_abc123def456">

    ```bash {{ title: 'cURL' }}
    curl -X DELETE https://api.vatly.com/v1/subscriptions/sub_abc123def456 \
      -H "Authorization: Bearer live_your_api_key_here"
    ```

    ```php {{ title: 'PHP' }}
    $vatly = new \Vatly\API\VatlyApiClient();
    $vatly->setApiKey('live_your_api_key_here');

    $vatly->subscriptions->cancel('sub_abc123def456');
    ```

    </CodeGroup>

  </Col>
</Row>
